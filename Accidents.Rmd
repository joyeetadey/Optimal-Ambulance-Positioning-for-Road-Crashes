---
title: "DA Jcomp Review 2"
author: "Joyeeta Dey"
date: "22/11/2021"
output: html_document
---

## installing packages
```{r}
library("rsample")
library("recipes")
library("viridisLite")
library("GGally")
library("tidyverse")
library("dplyr")
library("RColorBrewer")
library("timeDate")
library("leaflet")
library("timeDate")
library("solrad")
library("RColorBrewer")
library("lattice")
library("ggcorrplot")
```

## reading datasets
```{r}
acdnt <- read.table("C:/Users/Joyeeta/Desktop/sem 5/DA project/accidents.csv",header=TRUE,sep=",")

weather <- read.table("C:/Users/Joyeeta/Desktop/sem 5/DA project/weather.csv",header=TRUE,sep=",")

roads <- read.table("C:/Users/Joyeeta/Desktop/sem 5/DA project/segment.csv",header=TRUE,sep=",")
```

# Accidents Dataset
### Data Information
```{r}
dim(acdnt)
str(acdnt)
summary(acdnt)
head(acdnt,5)
```
### Data Manipulation
```{r}
## changing the datetime class
pd <- as.POSIXlt(acdnt$datetime)
head(pd,3)
pd <- unclass(pd)
pd$yr <- pd$year + 1900

## splitting datetime into hrs, mins, sec, day, month and year and adding them into the dataframe
accident_df <- acdnt %>%
  mutate(acdnt, sec = pd$sec, min=pd$min, hour=pd$hour, day=pd$mday, month=pd$mon, year = pd$yr, wday=pd$wday) 

## checking whether the day is a weekday or weekend
accident_df <- accident_df %>%
  mutate(accident_df,weekend=isWeekend(acdnt$datetime,wday = 1:6)) 

accident_df$weekend <- as.numeric(accident_df$weekend)

## seperating the date and time field from datetime and adding the date in suitable format
accident_df<-tidyr::separate(accident_df, datetime, c("date", "time"), sep = " ")
accident_df$date <- format(as.Date(accident_df$date), "%d-%m-%Y")
acc_df <- accident_df[-c(1)]

## function to calculate distance of a given point from the centre
update_df <- function(df,lat=-1.286389,long=36.817223){
  dist <- sqrt((lat-df$latitude)*(lat-df$latitude) + (long-df$longitude)*(long-df$longitude))
  df <- df%>%
    mutate(distance_from_centre=dist)
  return(df)
}

## adding distance from the centre 
acdnt_final <- update_df(acc_df)

## sun elevation angle
density <- replicate(6318, 6317.6) # according to wikipedia 2019 demographics
acdnt_final <- acdnt_final %>%
  mutate(elevation = Altitude(day, Lat = latitude , Lon=longitude, SLon=0, DS=0)) %>% # elevation 
  mutate(population_density = density) # population density

head(acdnt_final,5)
```
## Color palette
```{r}
pal <- brewer.pal(n = 8, name = "YlOrRd")
pal
```


## Basic Statistics
```{r}
#how many data from 2018 and 2019
week_sur <- table(accident_df$wday)
week_sur
sample_size=nrow(accident_df)
old=options(digits=2) #two decimal places
rel_freq=week_sur/sample_size
rel_freq


# density plot of accidents based on weekdays
densityplot(accident_df$wday, main="car crashes on weekdays",col=("#FED976"))
densityplot(accident_df$weekend, main="car crashes on weekdays vs weekends",col=("#B10026"))

# car crashes based on the hours
hr_table <- table(accident_df$hour)
hr_table
barplot(hr_table, col=(pal),main="car crashes based on hours")

# car crashes based on month
mon_table <- table(accident_df$month)
mon_table
barplot(mon_table, col=(pal), main="car crashes based on month")

accident_df <- read.table("C:/Users/Joyeeta/Desktop/sem 5/DA project/accidents2.csv",header=TRUE,sep=",")


#how many data from 2018 and 2019
year_sur <- table(accident_df$year)
year_sur

yr_table <- table(accident_df$year)
yr_table
barplot(yr_table, col=(pal),main="car crashes based on year")

#relative frequency of year 2018 and 2019
sample_size=nrow(accident_df)
old=options(digits=2) #two decimal places
rel_freq=year_sur/sample_size
rel_freq

```

## Basic Statistics
```{r}

#lattitude and longitude stats
lat=accident_df$latitude
lat_range = range(lat) 
lat_range

breaks=seq(-3.05000000215335,-0.565402313796744,by=0.5)
lat_age=accident_df$latitude
lat_cut=cut(lat_age,breaks,right=FALSE) 
head(lat_cut,5)

lat_freq=table(lat_cut)
lat_freq

cbind(lat_freq)
which.max(lat_freq)
# maximum latitude frequency

# longitudes
long=accident_df$latitude
long_range = range(long) 
long_range

breaks=seq(36.332201603768,37.8794900011581,by=0.25)
long_age=accident_df$longitude
long_cut=cut(long_age,breaks,right=FALSE) 
head(long_cut,5)

long_freq=table(long_cut)
long_freq

# maximum longitude frequency
cbind(long_freq)
which.max(long_freq)

library(ggplot2)

weekend_factor <- factor(accident_df$weekend)

## distribution of accident based on hours and weekdays
ggplot(accident_df,aes(x=hour,fill=factor(year)))+geom_histogram(bins=10)+scale_fill_manual(values = c('#FED976','#FD8D3C'))+labs(title = "Distribution of hours",y='frequency')+facet_wrap(weekend_factor)+stat_bin(bins = 10)

## distribution of accident based on longitude and weekdays
ggplot(accident_df, aes(x=longitude,fill=weekend_factor))+scale_fill_manual(values = c('#B10026','#FD8D3C'))+geom_boxplot()+labs(title = "distribution of accident based on longitude and weekdays")

## distribution of accident based on latitude and weekdays
ggplot(accident_df, aes(x=latitude,fill=weekend_factor))+scale_fill_manual(values = c('#FED976','#FD8D3C'))+geom_boxplot()+labs(title = "distribution of accident based on latitude and weekdays")


yr_factor <- factor(accident_df$year)

## distribution of accident based on longitude and weekdays and year
ggplot(accident_df, aes(x=latitude,y=longitude ,fill=weekend_factor))+scale_fill_manual(values = pal)+geom_violin()+facet_wrap(yr_factor)+labs(title = "distribution of accident based on longitude and weekday and years")


## location of crash site based on days of the week
week_factor <- factor(accident_df$wday,levels=c(0,1,2,3,4,5,6),labels = c("Sunday","Monday","Tuesday","Wednesday","Thusrday","Friday","Saturday"))

ggplot(accident_df,aes(x=latitude,y=longitude))+geom_point(color="#FD8D3C")+facet_wrap(week_factor)+labs(title = "Crash site per week")

## location of crashes every 3 hours
ggplot(acc_df,aes(x=hour))+geom_histogram(binwidth=3,fill="#FC4E2A")+labs(title = "Crashes every 3 hours",y='frequency')+facet_wrap(week_factor,ncol=1)

## location of Crashes per month - weekdays analysis
ggplot(acc_df,aes(x=month))+geom_histogram(binwidth=2,fill="#FD8D3C")+labs(title = "Crashes per month - weekdays analysis",y='frequency')+facet_wrap(week_factor,ncol=1)

cor_df <- accident_df %>%
  select(-X, -date,-time)

head(cor_df,5)

pal <- brewer.pal(n = 5, name = "YlOrRd")
pal


ggcorrplot(cor(cor_df), type = "lower",
     outline.col = "white", method = "circle",color=pal)+labs(title = "Correlation between the variables")

correlation <- cor(cor_df)
View(correlation)
correlation

```

# Inferences
based on the following data analytics and visualizations, we conclude the following inferences

* Most number of accidents occur on Wednesday and Thursday, they can be concluded as the busiest road days of the week.
* Accidents occuring on weekends is very minimal compared to those occuring on weekends
* Most number of accidents occur between 6:00 am to 7:00 am. Although the traffic is less at that time, but people overspeed due to empty roads, and hence, causing more accidents
* Accidents mostly occur the months of March and May

```{r}

```


